# 更新集群密钥<a name="ZH-CN_TOPIC_0173397686"></a>

## 操作场景<a name="section5340973015462"></a>

在创建集群时，系统将自动生成加密密钥key值以对集群的部分安全信息（例如所有数据库用户密码、密钥文件访问密码等）进行加密存储。在集群安装成功后，建议用户定期通过以下操作手动更改密钥值。

## 对系统的影响<a name="section30675106154659"></a>

-   更新集群密钥后，集群中新增加一个随机生成的新密钥，用于加密解密新保存的数据。旧的密钥不会删除，用于解密旧的加密数据。在修改安全信息后，例如修改数据库用户密码，新密码将使用新的密钥加密。
-   更新集群密钥需要停止集群，集群停止时无法访问。

## 前提条件<a name="section51431510154729"></a>

停止依赖集群运行的上层业务应用。

## 操作步骤<a name="section48453941154734"></a>

1.  在集群详情页，单击页面右上角“管理操作 \> 停止所有组件”。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >针对MRS 1.8.10及之前版本，具体请参见[更新集群密钥](更新集群密钥-176.md)。  

2.  登录主管理节点。
3.  执行以下命令切换用户：

    **sudo su - omm**

4.  执行以下命令，防止超时退出。

    **TMOUT=0**

5.  执行以下命令，切换目录。

    **cd $\{BIGDATA\_HOME\}/om-0.0.1/tools**

6.  执行以下命令，更新集群密钥。

    **sh updateRootKey.sh**

    根据界面提示，输入**y**：

    ```
    The root key update is a critical operation.
    Do you want to continue?(y/n):
    ```

    界面提示以下信息表示更新密钥成功：

    ```
    ...
    Step 4-1: The key save path is obtained successfully.
    ...
    Step 4-4: The root key is sent successfully.
    ```

7.  在集群详情页，单击页面右上角“管理操作 \> 启动所有组件”。

    在弹出的提示框中单击“是”，开始启动集群。界面提示“操作成功。”，单击“完成”，集群成功启动。


