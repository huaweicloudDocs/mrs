# 更新客户端<a name="ZH-CN_TOPIC_0035209723"></a>

## 更新客户端配置文件<a name="section49706223568"></a>

**操作场景**

MRS集群提供了客户端，可以在连接服务端、查看任务结果或管理数据的场景中使用。用户需要使用MRS的客户端时，或者在MRS Manager修改了服务配置参数并重启了服务，需要先下载并更新客户端配置文件。

用户创建集群时，默认在集群所有节点的“/opt/client“目录安装保存了原始客户端。集群创建完成后，仅Master节点的客户端可以直接使用，Core节点客户端在使用前需要更新客户端配置文件。

**操作步骤**

1.  登录MRS Manager。
2.  单击“服务管理“，然后单击“下载客户端“。

    “客户端类型“选择“仅配置文件“，“下载路径“选择“服务器端“，单击“确定“开始生成客户端配置文件，文件生成后默认保存在主管理节点“/tmp/MRS-client“。文件保存路径支持自定义。

    **图 1**  下载客户端配置文件<a name="fig196531535987"></a>  
    ![](figures/下载客户端配置文件.png "下载客户端配置文件")

3.  查询并登录主Master节点，具体请参见[查看主备节点](查看主备节点.md)。
4.  执行以下命令切换用户：

    **sudo su - omm**

5.  执行以下命令切换客户端目录：

    **cd /opt/client**

6.  执行以下命令，更新客户端配置：

    **sh refreshConfig.sh** _客户端安装目录_ _客户端配置文件压缩包完整路径_

    例如，执行命令：

    **sh refreshConfig.sh /opt/client /tmp/MRS-client/MRS\_Services\_Client.tar**

    界面显示以下信息表示配置刷新更新成功：

    ```
    ReFresh components client config is complete.
    Succeed to refresh components client config.
    ```


## 全量更新主Master节点的原始客户端<a name="section92959464575"></a>

**场景描述**

用户创建集群时，默认在集群所有节点的“/opt/client”目录安装保存了原始客户端。

-   MRS普通集群，在console页面提交作业时，会使用master节点上预置安装的客户端进行作业提交。
-   用户也可使用master节点上预置安装的客户端来连接服务端、查看任务结果或管理数据等

对集群安装补丁后，用户需要重新更新master节点上的客户端，才能保证继续使用内置客户端功能。

**操作步骤**

1.  <a name="li5454202185811"></a>登录MRS Manager。
2.  单击“服务管理“，然后单击“下载客户端“。

    “客户端类型“选择“完整客户端“，“下载路径“选择“服务器端“，单击“确定“开始生成客户端配置文件，文件生成后默认保存在主管理节点“/tmp/MRS-client“。文件保存路径支持自定义。

3.  <a name="li14850170195112"></a>查询并登录主Master节点，具体请参见[查看主备节点](查看主备节点.md)。
4.  <a name="li3635762195625"></a>在弹性云服务器，切换到**root**用户，并将安装包复制到目录“/opt“。

    **sudo su - root**

    **cp /tmp/MRS-client/MRS\_Services\_Client.tar /opt**

5.  在“/opt“目录执行以下命令，解压压缩包获取校验文件与客户端配置包。

    **tar -xvf MRS\_Services\_Client.tar**

6.  执行以下命令，校验文件包。

    **sha256sum -c MRS\_Services\_ClientConfig.tar.sha256**

    界面显示如下：

    ```
    MRS_Services_ClientConfig.tar: OK
    ```

7.  执行以下命令，解压“MRS\_Services\_ClientConfig.tar“。

    **tar -xvf MRS\_Services\_ClientConfig.tar**

8.  执行以下命令，移走原来老的客户端到/opt/client\_bak目录下

    **mv /opt/client**  /opt/client\_bak

9.  执行以下命令，安装客户端到新的目录，客户端路径必须为“/opt/client“。

    **sh /opt/MRS\_Services\_ClientConfig/install.sh /opt/client**

    查看安装输出信息，如有以下结果表示客户端安装成功：

    ```
    Components client installation is complete.
    ```

10. 执行以下命令，修改/opt/client目录的所属用户和用户组。

    **chown omm:wheel /opt/client -R**

11. 执行以下命令配置环境变量：

    **source /opt/client/bigdata\_env**

12. 如果当前集群已启用Kerberos认证，执行以下命令认证当前用户。如果当前集群未启用Kerberos认证，则无需执行此命令。

    **kinit** **_MRS集群用户_**

    例如,  **kinit admin**.

13. <a name="li6221236418107"></a>执行组件的客户端命令。

    例如，执行以下命令查看HDFS目录：

    **hdfs dfs -ls /**


## 全量更新备Master节点的原始客户端<a name="section1129715468573"></a>

1.  参见[1](#li5454202185811)\~[3](#li14850170195112)登录备Master节点，执行如下命令切换到omm用户。

    **sudo su - omm**

2.  在备master节点上执行如下命令（该命令以master1节点为主master节点为例）从主master节点拷贝下载的客户端包。

    **scp omm@master1\_host\_name:/tmp/MRS-client/MRS\_Services\_Client.tar  **/tmp/MRS-client/****

3.  参见[4](#li3635762195625)\~[13](#li6221236418107)，更新备Master节点的客户端。

